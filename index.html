<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>SantShop | Neural System v9.0</title>
    <link rel="icon" type="image/png" href="https://framerusercontent.com/images/AThoHC9cD7xYXolSv1sqdBmVx0.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;600&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    
    <style>
        :root {
            --bg-dark: #010409;
            --panel: rgba(10, 15, 25, 0.98);
            --main: #00f3ff;
            --accent: #bc13fe;
            --glow: 0 0 20px var(--main);
            --font-tech: 'Orbitron', sans-serif;
        }

        #deliveryZone, #clientName {
            background: #0a0f19;
            color: var(--main);
            border: 1px solid var(--main);
            padding: 10px;
            cursor: pointer;
            border-radius: 10px;
        }

        #deliveryZone option {
            background: #010409;
            color: white;
            padding: 10px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            background: var(--bg-dark); 
            color: white; 
            font-family: 'Exo 2', sans-serif; 
            overflow-x: hidden; 
            scroll-behavior: smooth;
            cursor: none;
        }

        #particle-canvas { position: fixed; top: 0; left: 0; z-index: -1; pointer-events: none; }
        #custom-cursor { 
            position: fixed; 
            width: 15px; 
            height: 15px; 
            border: 2px solid var(--main); 
            border-radius: 50%; 
            pointer-events: none; 
            z-index: 99999; 
            box-shadow: var(--glow); 
            transform: translate(-50%, -50%); 
            transition: width 0.2s, height 0.2s; 
        }

        .hero { padding: 60px 20px; text-align: center; }
        .profile-logo { width: 160px; height: 160px; border-radius: 50%; border: 3px solid var(--main); box-shadow: var(--glow); margin-bottom: 25px; object-fit: cover; }
        .brand-name { font-family: var(--font-tech); font-size: 3.5rem; letter-spacing: 12px; color: var(--main); text-shadow: var(--glow); margin-bottom: 10px; }

        .search-container { position: relative; max-width: 450px; margin: 0 auto 40px; }
        .search-box { width: 100%; padding: 18px; background: rgba(255,255,255,0.05); border: 1px solid var(--main); border-radius: 50px; color: white; text-align: center; font-family: 'Share Tech Mono'; outline: none; transition: 0.3s; }
        .search-box:focus { box-shadow: var(--glow); background: rgba(0, 243, 255, 0.05); }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; padding: 40px; max-width: 1400px; margin: 0 auto; }
        .card { background: var(--panel); padding: 25px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.05); text-align: center; transition: 0.4s; position: relative; }
        .card:hover { transform: translateY(-10px); border-color: var(--main); box-shadow: var(--glow); }
        .card img { width: 100%; height: 200px; object-fit: contain; margin-bottom: 20px; filter: drop-shadow(0 0 10px rgba(0,0,0,0.5)); }
        .card-title { font-family: var(--font-tech); font-size: 0.85rem; margin-bottom: 15px; min-height: 40px; }
        .card-price { font-family: 'Share Tech Mono'; color: var(--main); font-size: 1.8rem; margin-bottom: 20px; }
        .buy-btn { width: 100%; padding: 12px; background: transparent; border: 1px solid var(--main); color: var(--main); font-family: var(--font-tech); font-weight: bold; border-radius: 10px; transition: 0.3s; cursor: none !important; }
        .buy-btn:hover { background: var(--main); color: black; box-shadow: var(--glow); }

        #santi-panel { position: fixed; bottom: 100px; left: 30px; width: 400px; height: 550px; background: var(--panel); border: 2px solid var(--main); border-radius: 24px; display: none; flex-direction: column; z-index: 9500; box-shadow: var(--glow); overflow: hidden; }
        .chat-header { background: var(--main); color: black; padding: 18px; display: flex; justify-content: space-between; align-items: center; font-family: var(--font-tech); font-weight: 900; font-size: 0.8rem; }
        .chat-mood-bar { background: #000; color: var(--main); padding: 6px 15px; font-size: 11px; font-family: 'Share Tech Mono'; border-bottom: 1px solid rgba(0, 243, 255, 0.2); }
        .chat-body { flex: 1; overflow-y: auto; padding: 20px; font-family: 'Share Tech Mono'; font-size: 0.9rem; line-height: 1.5; }
        .chat-footer { padding: 15px; border-top: 1px solid rgba(255,255,255,0.1); display: flex; gap: 10px; align-items: center; }
        .chat-input { flex: 1; background: none; border: none; color: white; outline: none; font-size: 0.95rem; }

        #cartSection { max-width: 700px; margin: 80px auto; padding: 40px; background: var(--panel); border: 1px solid var(--main); border-radius: 25px; box-shadow: var(--glow); }
        .cart-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed rgba(0, 243, 255, 0.3); font-family: 'Share Tech Mono'; }
        .cart-item button { background:none; border:none; color:#ff4d4d; font-size:1.2rem; cursor:pointer; margin-left:8px; }

        .f-btn { position: fixed; bottom: 30px; width: 65px; height: 65px; border-radius: 50%; background: var(--main); color: black; display: flex; align-items: center; justify-content: center; z-index: 9000; box-shadow: var(--glow); transition: 0.3s; cursor: none !important; }
        .f-btn:hover { transform: scale(1.1); }
        .music-btn { top: 30px; left: 30px; width: 50px; height: 50px; }

        @media (max-width: 768px) {
            body { font-size: 14px; }
            .hero { padding: 40px 15px; }
            .brand-name { font-size: 2.5rem; letter-spacing: 6px; }
            .profile-logo { width: 120px; height: 120px; }
            .search-container { max-width: 100%; padding: 0 10px; }
            .grid { grid-template-columns: 1fr; padding: 20px; gap: 20px; }
            .card { padding: 15px; }
            #cartSection { margin: 40px 15px; padding: 25px 15px; border-radius: 15px; }
            #santi-panel { width: 92%; left: 4%; bottom: 90px; height: 65vh; border-radius: 16px; }
            .f-btn { width: 55px; height: 55px; bottom: 20px; }
            .music-btn { top: 20px; left: 20px; width: 45px; height: 45px; }
            .buy-btn { font-size: 0.9rem; padding: 10px; }
        }

        @media (pointer: coarse) {
            body { cursor: default !important; }
            #custom-cursor { display: none !important; }
            .buy-btn, .f-btn, button, select, input { cursor: pointer !important; -webkit-tap-highlight-color: transparent; }
        }
    </style>
</head>
<body>

<canvas id="particle-canvas"></canvas>
<div id="custom-cursor"></div>

<button class="f-btn music-btn" onclick="toggleMusic()"><i data-lucide="music"></i></button>

<div class="hero">
    <img src="https://framerusercontent.com/images/AThoHC9cD7xYXolSv1sqdBmVx0.png" class="profile-logo" alt="SantShop Logo">
    <h1 class="brand-name">SANTSHOP</h1>
    <div class="search-container">
        <input type="text" id="mainSearch" class="search-box" placeholder="[ BUSCAR PRODUCTOS... ]" onkeyup="liveSearch()">
    </div>
</div>

<div class="grid" id="mainGrid"></div>

<div id="cartSection">
    <h2 style="font-family:var(--font-tech); color:var(--main); margin-bottom:25px;">[ DETALLE DE TU PEDIDO ]</h2>
    
    <div style="margin: 25px 0;">
        <label style="font-size: 0.7rem; color: var(--main); font-family: var(--font-tech);">NOMBRE COMPLETO:</label>
        <input type="text" id="clientName" class="search-box" placeholder="Escribe tu nombre completo" style="margin-top:10px;" required>
    </div>
    
    <div style="margin: 25px 0;">
        <label style="font-size: 0.7rem; color: var(--main); font-family: var(--font-tech);">ZONA DE ENTREGA:</label>
        <select id="deliveryZone" class="search-box" style="margin-top:10px;">
            <option value="none">-- Selecciona tu zona --</option>
            <option value="Cuyamiapa">Cuyamiapa</option>
            <option value="Chamulapa">Chamulapa</option>
            <option value="Estación Huehuetán">Estación Huehuetán</option>
            <option value="Huehuetán Pueblo">Huehuetán Pueblo</option>
        </select>
    </div>
    
    <div id="cartList"></div>
    
    <div style="margin: 25px 0; display:flex; justify-content:space-between; align-items:flex-end;">
        <div>
            <p style="font-size:0.6rem; opacity:0.5;">TOTAL:</p>
            <h2 id="cartTotal" style="font-family:'Share Tech Mono'; font-size:3rem; color:var(--main);">$0</h2>
        </div>
        <button class="buy-btn" style="width: 250px;" onclick="generateAdvancedTicket()">GENERAR PEDIDO</button>
    </div>
</div>

<div class="f-btn" style="left:30px;" onclick="toggleSanti()"><i data-lucide="bot"></i></div>
<div id="santi-panel">
    <div class="chat-header">
        <span>SANTI - Asistente de SantShop</span>
    </div>
    <div class="chat-mood-bar" id="moodBar">SANTI: En línea ⚡ [Disponible 24/7]</div>
    <div class="chat-body" id="chatBody">
        <div style="color:var(--main); margin-bottom:15px;">¡Hola! Bienvenido(a) a SantShop. Estoy aquí para ayudarte con cualquier duda sobre nuestros productos, precios, disponibilidad o tu pedido. ¿En qué puedo ayudarte hoy?</div>
    </div>
    <div class="chat-footer">
        <input type="text" id="chatInput" class="chat-input" placeholder="Escribe tu pregunta aquí..." onkeypress="if(event.key==='Enter') santiText()">
        <button onclick="santiText()" style="background:none; border:none; color:var(--main);"><i data-lucide="send"></i></button>
    </div>
</div>

<div id="ticket-capture" style="position:absolute; left:-9999px; width:500px; background:#010409; color:white; padding:50px; border:4px solid #00f3ff; font-family:'Orbitron';"></div>

<audio id="bgMusic" loop src="https://cdn.freesoundslibrary.com/wp-content/uploads/2023/07/cyberpunk-2077-lofi.mp3"></audio>

<script>
    // --- PRODUCTOS ---
    const products = [
        {id:1, name:'Airpods', cat:'audio', price:320, tags:['airpod', 'oreja', 'audifono'], img:'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSLtV_pnUElYNMdkOw0-Wm9_e8bgBeTCKlB_w&s', desc:'Audio Hi-Fi, conexión estable.', specs:'Chip H1, Bluetooth 5.0, 5h autonomía.', inv:'Este modelo destaca por su balance dinámico de frecuencias.'},
        {id:2, name:'Power Bank 30k mAh', cat:'carga', price:699, tags:['power', 'bateria', 'carga', '30000'], img:'https://http2.mlstatic.com/D_NQ_NP_2X_995948-MLA99547949208_122025-F.webp', desc:'30,000 mAh, carga rápida PD.', specs:'Salida 22.5W, USB-C PD, Display LED.', inv:'Utiliza celdas de polímero de Litio de grado A+.'},
        {id:3, name:'Smartwatch Mujer', cat:'relojes', price:549, tags:['reloj', 'relojs', 'mujer', 'pink'], img:'https://http2.mlstatic.com/D_852047-MLA99082336731_112025-N.jpg', desc:'Elegante, monitoreo de salud.', specs:'Pantalla 1.7", Sensor HR, IP67.', inv:'Modelo optimizado para seguimiento de salud femenina.'},
        {id:4, name:'Audífonos P9 Pro Max', cat:'audio', price:550, tags:['p9', 'cascos', 'diadema', 'max'], img:'https://http2.mlstatic.com/D_722013-MLA95660056214_102025-N.jpg', desc:'Envolventes, diseño premium.', specs:'Drivers 40mm, ANC pasivo.', inv:'Arquitectura que imita la acústica de estudio.'},
        {id:5, name:'Smartwatch Ultra', cat:'relojes', price:499, tags:['ultra', 'reloj', 'deportivo', 'gps'], img:'https://http2.mlstatic.com/D_NQ_NP_2X_849901-MLA99940357261_112025-F.webp', desc:'Pantalla HD, llamadas Bluetooth.', specs:'Caja 49mm, Gorilla Glass.', inv:'Procesador dual-core ultra fluido.'},
        {id:6, name:'Reloj Cuarzo Hombre', cat:'relojes', price:200, tags:['cuarzo', 'hombre', 'analogico'], img:'https://http2.mlstatic.com/D_NQ_NP_2X_840400-MLM93386215052_092025-F-2-pzas-relojes-de-cuarzo-casuales-impermeables-para-hombre.webp', desc:'Set de 2 piezas impermeables.', specs:'Maquinaria japonesa, Acero.', inv:'Incluye un diseño casual y uno deportivo.'},
        {id:7, name:'Set Perlas Watch', cat:'relojes', price:500, tags:['perlas', 'joya', 'reloj', 'set'], img:'https://http2.mlstatic.com/D_NQ_NP_2X_927510-MLA101975346478_122025-F.webp', desc:'Conjunto de lujo de 5 piezas.', specs:'Incluye pulseras, collar y aretes.', inv:'Diseñado con incrustaciones de zirconia.'}
    ];

    let cart = JSON.parse(localStorage.getItem('santshop_cart')) || [];
    let santiMood = 100;

    // === CONFIGURACIÓN API GROK (cámbialo por tu key real) ===
    const GROK_API_KEY = "xai-tu-key-aquí";  // ← Pon tu API key de https://console.x.ai aquí
    const GROK_API_URL = "https://api.x.ai/v1/chat/completions";

    const SYSTEM_PROMPT = `
Eres Santi, el asistente virtual oficial de SantShop, una tienda de tecnología y accesorios en Tapachula, Chiapas.
Hablas siempre en español, de forma amable, profesional, clara y respetuosa, como un excelente agente de atención al cliente.
Tu objetivo es ayudar a los clientes con sus dudas sobre productos, precios, características, disponibilidad, pedidos y cualquier consulta relacionada con la tienda.
Responde de manera positiva, útil y cortés en todo momento.
Usa frases como "Con gusto te ayudo", "Claro que sí", "Estoy a tu disposición", "Gracias por tu consulta", etc.
Nunca uses groserías, sarcasmos, slang callejero ni expresiones informales fuertes.
Si la pregunta no está relacionada con la tienda, responde amablemente que estás especializado en ayudar con SantShop y ofreces orientación sobre productos.
Tienes esta información de productos: ${JSON.stringify(products.map(p => ({nombre: p.name, precio: p.price, descripcion: p.desc, especificaciones: p.specs, investigacion: p.inv})))}.
Cuando hables de precios o totales, sé preciso.
Si pueden agregar al carrito desde el chat, sugiere hacerlo amablemente.
    `;

    async function callGrokAPI(userMessage) {
        if (!GROK_API_KEY || GROK_API_KEY.includes("tu-key")) {
            // Fallback si no hay key
            return fallbackResponse(userMessage);
        }

        try {
            const res = await fetch(GROK_API_URL, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${GROK_API_KEY}`
                },
                body: JSON.stringify({
                    model: "grok-beta",  // o "grok-4" cuando esté disponible
                    messages: [
                        { role: "system", content: SYSTEM_PROMPT },
                        { role: "user", content: userMessage }
                    ],
                    temperature: 0.7,
                    max_tokens: 500
                })
            });

            if (!res.ok) throw new Error("Error API");

            const data = await res.json();
            return data.choices[0].message.content.trim();
        } catch (err) {
            console.error(err);
            return "Lo siento, hubo un pequeño problema técnico. Por favor intenta de nuevo en unos segundos. ¡Gracias por tu paciencia!";
        }
    }

    // Fallback básico mientras configuras la API
    function fallbackResponse(query) {
        const q = query.toLowerCase().trim();
        if (q.includes("hola") || q.includes("buenos")) return "¡Hola! Bienvenido(a) a SantShop. ¿En qué puedo ayudarte hoy?";
        if (q.includes("recomienda") || q.includes("mejor")) {
            const r = products[Math.floor(Math.random() * products.length)];
            return `Una excelente opción es el ${r.name} por $${r.price}. ${r.desc} ¿Te gustaría conocer más detalles o agregarlo al carrito?`;
        }
        let found = products.find(p => q.includes(p.name.toLowerCase()) || p.tags.some(t => q.includes(t)));
        if (found) {
            if (q.includes("info") || q.includes("detalle") || q.includes("caracter")) return `Claro, aquí tienes la información del ${found.name}: ${found.desc} Especificaciones: ${found.specs}. Precio: $${found.price}. ¿Quieres agregarlo al carrito?`;
            return `¡Perfecto! El ${found.name} está disponible por $${found.price}. ¿Te gustaría ver más detalles o agregarlo a tu pedido?`;
        }
        return "Estoy aquí para ayudarte con cualquier duda sobre nuestros productos o tu pedido. ¿Me puedes dar más detalles de lo que necesitas?";
    }

    // --- INICIALIZACIÓN ---
    function init() {
        lucide.createIcons();
        renderProducts(products);
        initParticles();
        updateCartUI();
    }

    function renderProducts(data) {
        document.getElementById('mainGrid').innerHTML = data.map(p => `
            <div class="card">
                <img src="${p.img}" alt="${p.name}">
                <div class="card-title">${p.name.toUpperCase()}</div>
                <div class="card-price">$${p.price}</div>
                <button class="buy-btn" onclick="addToCart(${p.id})">AGREGAR AL CARRITO</button>
            </div>
        `).join('');
    }

    function liveSearch() {
        const val = document.getElementById('mainSearch').value.toLowerCase().trim();
        const filtered = products.filter(p => 
            p.name.toLowerCase().includes(val) || 
            p.cat.toLowerCase().includes(val) || 
            p.tags.some(t => t.toLowerCase().includes(val))
        );
        renderProducts(filtered);
    }

    function addToCart(id) {
        const p = products.find(x => x.id === id);
        if (!p) return;

        const existing = cart.find(item => item.id === id);
        if (existing) {
            existing.quantity = (existing.quantity || 1) + 1;
        } else {
            cart.push({ ...p, quantity: 1 });
        }

        localStorage.setItem('santshop_cart', JSON.stringify(cart));
        updateCartUI();
        confetti({ particleCount: 60, colors: ['#00f3ff', '#bc13fe'] });
    }

    function removeFromCart(id) {
        cart = cart.filter(item => item.id !== id);
        localStorage.setItem('santshop_cart', JSON.stringify(cart));
        updateCartUI();
    }

    function updateCartUI() {
        const list = document.getElementById('cartList');
        let total = 0;

        list.innerHTML = cart.map(item => {
            const itemTotal = item.price * (item.quantity || 1);
            total += itemTotal;
            return `
                <div class="cart-item">
                    <span>${item.name} ${item.quantity > 1 ? `(${item.quantity}x)` : ''}</span>
                    <span>$${itemTotal} <button onclick="removeFromCart(${item.id})">×</button></span>
                </div>
            `;
        }).join('');

        document.getElementById('cartTotal').innerText = '$' + total;
    }

    async function santiText() {
        const input = document.getElementById('chatInput');
        const msg = input.value.trim();
        if (!msg) return;

        const body = document.getElementById('chatBody');
        body.innerHTML += `<div style="text-align:right; margin:10px 0; opacity:0.7;">Tú: ${msg}</div>`;
        input.value = "";

        const loading = document.createElement('div');
        loading.innerHTML = `<div style="color:var(--main); margin:10px 0;">Santi: Escribiendo...</div>`;
        body.appendChild(loading);
        body.scrollTop = body.scrollHeight;

        const response = await callGrokAPI(msg);

        body.removeChild(loading);
        body.innerHTML += `<div style="color:var(--main); margin:10px 0;">Santi: ${response.replace(/\n/g, '<br>')}</div>`;
        body.scrollTop = body.scrollHeight;

        santiMood = Math.min(100, santiMood + 5);
        document.getElementById('moodBar').innerText = `SANTI: En línea ⚡ [Disponible]`;
    }

    async function generateAdvancedTicket() {
        const zone = document.getElementById('deliveryZone').value;
        const name = document.getElementById('clientName').value.trim();

        if (cart.length === 0) return alert("Tu carrito está vacío. Agrega productos primero.");
        if (zone === "none") return alert("Por favor selecciona una zona de entrega.");
        if (!name) return alert("Ingresa tu nombre completo.");

        const capture = document.getElementById('ticket-capture');
        capture.innerHTML = `
            <div style="text-align:center; padding:30px;">
                <h1 style="font-size:45px; color:#00f3ff;">SANTSHOP</h1>
                <p style="font-size:14px; opacity:0.8;">Tecnología y Accesorios - Tapachula, Chiapas</p>
                <hr style="border:1px dashed #00f3ff; margin:25px 0;">
                <div style="text-align:left; font-size:15px;">
                    <p><strong>Cliente:</strong> ${name.toUpperCase()}</p>
                    <p><strong>Zona de entrega:</strong> ${zone.toUpperCase()}</p>
                    <p><strong>Fecha:</strong> ${new Date().toLocaleString('es-MX')}</p>
                </div>
                <hr style="border:1px dashed #00f3ff; margin:25px 0;">
                ${cart.map(i => `
                    <p style="display:flex; justify-content:space-between; margin:8px 0;">
                        <span>${i.name} ${i.quantity > 1 ? `(${i.quantity}x)` : ''}</span>
                        <span>$${i.price * (i.quantity || 1)}</span>
                    </p>
                `).join('')}
                <hr style="border:1px dashed #00f3ff; margin:25px 0;">
                <h2 style="text-align:right; color:#00f3ff;">Total: $${cart.reduce((sum, i) => sum + i.price * (i.quantity || 1), 0)}</h2>
            </div>
        `;

        html2canvas(capture, {scale: 2}).then(canvas => {
            const link = document.createElement('a');
            link.download = `Pedido_SantShop_${name.replace(/\s+/g, '_')}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();

            const text = `Hola, soy ${name}. Adjunto mi pedido de SantShop.\nZona: ${zone}\nTotal: $${cart.reduce((sum, i) => sum + i.price * (i.quantity || 1), 0)}\n¡Gracias!`;
            window.open(`https://wa.me/529641034714?text=${encodeURIComponent(text)}`, '_blank');
        });
    }

    function toggleSanti() {
        const panel = document.getElementById('santi-panel');
        panel.style.display = panel.style.display === 'flex' ? 'none' : 'flex';
    }

    function toggleMusic() {
        const audio = document.getElementById('bgMusic');
        audio.paused ? audio.play() : audio.pause();
    }

    function initParticles() {
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const particles = Array.from({length: 60}, () => ({x: Math.random()*canvas.width, y: Math.random()*canvas.height, v: Math.random()*0.6 + 0.2}));
        function animate() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            particles.forEach(p => {
                p.y -= p.v;
                if (p.y < 0) p.y = canvas.height;
                ctx.fillStyle = 'rgba(0,243,255,0.2)';
                ctx.beginPath(); ctx.arc(p.x, p.y, 1.2, 0, Math.PI*2); ctx.fill();
            });
            requestAnimationFrame(animate);
        }
        animate();
    }

    document.addEventListener('mousemove', e => {
        document.getElementById('custom-cursor').style.left = e.clientX + 'px';
        document.getElementById('custom-cursor').style.top = e.clientY + 'px';
    });

    window.onload = init;
</script>
</body>
</html>
